{% extends 'base.html' %}
{% load static %}

{% block title %}{{ title }} - Syrian Archive{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient-primary text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-file-text"></i> {{ title }}
                    </h4>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <!-- Title Field -->
                        <div class="mb-3">
                            <label for="{{ form.title.id_for_label }}" class="form-label">
                                <i class="bi bi-type"></i> Title *
                            </label>
                            {{ form.title }}
                            {% if form.title.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.title.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Content Field -->
                        <div class="mb-3">
                            <label for="{{ form.content.id_for_label }}" class="form-label">
                                <i class="bi bi-file-text"></i> Content *
                            </label>
                            {{ form.content }}
                            {% if form.content.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.content.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Location Field -->
                        <div class="mb-3">
                            <label for="{{ form.location.id_for_label }}" class="form-label">
                                <i class="bi bi-geo-alt"></i> Location
                            </label>
                            {{ form.location }}
                            {% if form.location.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.location.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Date Field -->
                        <div class="mb-3">
                            <label for="{{ form.date.id_for_label }}" class="form-label">
                                <i class="bi bi-calendar"></i> Date
                            </label>
                            {{ form.date }}
                            {% if form.date.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.date.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        <!-- Image Field -->
                        <div class="mb-3">
                            <label for="{{ form.attachment.id_for_label }}" class="form-label">
                                <i class="bi bi-paperclip"></i> Attachment (Optional)
                            </label>
                            {{ form.attachment }}
                            {% if form.attachment.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.attachment.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> Supported formats: JPG, PNG, GIF. Max size: 10MB.
                            </div>
                        </div>

                        <!-- Current Attachment Preview (for edit mode) -->
                        {% if post and post.attachment %}
                            <div class="mb-3">
                                <label class="form-label">Current Attachment:</label>
                                <div class="current-attachment-preview">
                                    <img src="{{ post.attachment.url }}" alt="Current attachment" class="img-thumbnail post-attachment" style="max-width: 300px; max-height: 200px;">
                                </div>
                            </div>
                        {% endif %}

                        <!-- People Field -->
                        <div class="mb-3">
                            <label for="{{ form.people.id_for_label }}" class="form-label">
                                <i class="bi bi-people"></i> Related People
                            </label>
                            {{ form.people }}
                            {% if form.people.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.people.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> Hold Ctrl/Cmd to select multiple people.
                            </div>
                        </div>

                        <!-- Events Field -->
                        <div class="mb-3">
                            <label for="{{ form.events.id_for_label }}" class="form-label">
                                <i class="bi bi-calendar-event"></i> Related Events
                            </label>
                            {{ form.events }}
                            {% if form.events.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.events.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="form-text">
                                <i class="bi bi-info-circle"></i> Hold Ctrl/Cmd to select multiple events.
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="{% if post %}{% url 'post_detail' post.pk %}{% else %}{% url 'post_list' %}{% endif %}" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-lg"></i> 
                                {% if post %}Update Post{% else %}Create Post{% endif %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add custom styling for form elements -->
<style>
.form-control, .form-select {
    border-radius: 8px;
    border: 2px solid #e9ecef;
    padding: 12px 15px;
    transition: all 0.3s ease;
}

.form-control:focus, .form-select:focus {
    border-color: var(--secondary-color, #3498db);
    box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
}

.form-label {
    font-weight: 600;
    color: var(--dark-color, #343a40);
    margin-bottom: 8px;
}

.current-image-preview {
    padding: 10px;
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    text-align: center;
    background-color: #f8f9fa;
}

textarea.form-control {
    min-height: 120px;
    resize: vertical;
}

select[multiple].form-select {
    min-height: 120px;
}
</style>
{% endblock %}